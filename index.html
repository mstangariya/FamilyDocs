<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Vault</title>

    <style>
        :root {
            --bg: #0f0f13;
            --card-bg: #1c1c21;
            --primary: #7F5AF0;
            --secondary: #2Cb67D;
            --text: #fffffe;
            --text-sub: #94a1b2;
            --glass: rgba(15, 15, 19, 0.95);
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }

        /* HEADER */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--glass);
            backdrop-filter: blur(12px);
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
        }

        .status-online {
            background: var(--secondary);
            box-shadow: 0 0 10px var(--secondary);
        }

        /* SEARCH */
        .search-wrapper {
            position: relative;
        }

        input[type="text"] {
            width: 100%;
            background: #2a2a30;
            border: none;
            padding: 14px 45px;
            border-radius: 14px;
            color: white;
            font-size: 16px;
            outline: none;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-sub);
        }

        .clear-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-sub);
            cursor: pointer;
            display: none;
        }

        /* TABS */
        .tabs-container {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 15px 20px;
        }

        .tab {
            background: var(--card-bg);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-sub);
            cursor: pointer;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        /* CONTENT */
        .content {
            padding: 10px 20px 100px;
        }

        .doc-card {
            background: var(--card-bg);
            padding: 18px;
            margin-bottom: 12px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            text-decoration: none;
            animation: slideUp 0.3s ease forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        .doc-info h3 {
            margin: 0;
            font-size: 16px;
        }

        .owner-badge {
            background: rgba(127, 90, 240, 0.2);
            color: #bb9af7;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 6px;
            margin-top: 4px;
            width: fit-content;
        }

        .arrow-icon {
            opacity: 0.6;
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #loading-text {
            text-align: center;
            margin-top: 50px;
            color: var(--text-sub);
        }

        /* BOTTOM BAR */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--glass);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 200;
        }

        .bottom-btn {
            text-align: center;
            font-size: 12px;
            color: var(--text-sub);
            cursor: pointer;
        }

        .bottom-btn span {
            font-size: 20px;
            display: block;
        }

        .bottom-btn:active {
            color: var(--primary);
            transform: scale(0.95);
        }
    </style>
</head>

<body>

    <!-- HEADER -->
    <div class="app-header">
        <div class="header-top">
            <h1>Family Vault</h1>
            <div id="statusDot" class="status-dot"></div>
        </div>
        <div class="search-wrapper">
            <div class="search-icon">üîç</div>
            <input type="text" id="searchInput" placeholder="Search docs..." onkeyup="handleSearch()">
            <div class="clear-icon" id="clearBtn" onclick="clearSearch()">‚úï</div>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs-container" id="tabsList"></div>

    <!-- CONTENT -->
    <div id="loading-text">Loading...</div>
    <div class="content" id="docList"></div>

    <!-- BOTTOM BAR -->
    <div class="bottom-bar">
        <div class="bottom-btn" onclick="goHome()">
            <span>üè†</span>Home
        </div>
        <div class="bottom-btn" onclick="refreshData()">
            <span>üîÑ</span>Refresh
        </div>
    </div>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbzkjTRJamsMlOyPXBc7hKk-fyRt-4kWDc617Ix4bsDUHxoSPabElS9OZ74vlGWkOxygYA/exec";

        let rawData = [];
        let flatData = [];
        let memberNames = [];
        let currentMemberIndex = 1;

        window.onload = function () {
            const cached = localStorage.getItem('familyDocsData');
            if (cached) processData(JSON.parse(cached));

            fetch(scriptURL)
                .then(res => res.json())
                .then(data => {
                    localStorage.setItem('familyDocsData', JSON.stringify(data));
                    processData(data);
                    document.getElementById("statusDot").classList.add("status-online");
                });
        };

        function processData(data) {
            rawData = data;
            document.getElementById("loading-text").style.display = "none";

            memberNames = [];
            flatData = [];

            for (let i = 1; i < data[0].length; i++) {
                if (data[0][i]) memberNames.push({ name: data[0][i], index: i });
            }

            for (let r = 1; r < data.length; r++) {
                for (let i = 1; i < data[0].length; i++) {
                    if (data[r][i]) {
                        flatData.push({
                            docName: data[r][0],
                            link: data[r][i],
                            owner: data[0][i],
                            ownerIndex: i
                        });
                    }
                }
            }

            renderTabs();
            selectMember(currentMemberIndex);
        }

        function renderTabs() {
            const t = document.getElementById("tabsList");
            t.innerHTML = "";
            memberNames.forEach(m => {
                const d = document.createElement("div");
                d.className = "tab" + (m.index === currentMemberIndex ? " active" : "");
                d.innerText = m.name;
                d.onclick = () => selectMember(m.index);
                t.appendChild(d);
            });
        }

        function selectMember(index) {
            currentMemberIndex = index;
            renderTabs();

            const list = [];
            for (let r = 1; r < rawData.length; r++) {
                if (rawData[r][index]) {
                    list.push({ docName: rawData[r][0], link: rawData[r][index] });
                }
            }
            renderList(list);
        }

        function handleSearch() {
            const q = searchInput.value.toLowerCase();
            clearBtn.style.display = q ? "block" : "none";
            tabsList.style.display = q ? "none" : "flex";

            renderList(q ? flatData.filter(d =>
                d.docName.toLowerCase().includes(q) ||
                d.owner.toLowerCase().includes(q)
            ) : []);
        }

        function clearSearch() {
            searchInput.value = "";
            handleSearch();
            selectMember(currentMemberIndex);
        }

        function renderList(items) {
            docList.innerHTML = "";
            if (!items.length) return;

            items.forEach((i, n) => {
                docList.innerHTML += `
                <a class="doc-card" href="${i.link}" target="_blank" style="animation-delay:${n * 0.05}s">
                    <div class="doc-info">
                        <h3>${i.docName}</h3>
                        ${i.owner ? `<div class="owner-badge">${i.owner}</div>` : ""}
                    </div>
                    <div class="arrow-icon">‚ûú</div>
                </a>`;
            });
        }

        function goHome() {
            clearSearch();
            selectMember(memberNames[0].index);
        }

        function refreshData() {
            location.reload();
        }
    </script>

</body>
</html>

